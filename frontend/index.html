<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pathways-based transition assessment repository</title>
    <script type="module" crossorigin="" src="./assets/api.js"></script>
    <link rel="stylesheet" crossorigin="" href="./assets/cards.css">
    <link rel="stylesheet" crossorigin="" href="./assets/code.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <script>
      async function callApi(path, api_key = "") {
        const url = "http://localhost" + path;
        try {
          const response = await fetch(url, {
            method: "GET",
            headers: {
              'accept': 'application/json',
              'X-API-Key': api_key
            }
          });
          if (!response.ok) {
            throw new Error(`Response status: ${response.status}`);
          }

          const json = await response.json();
          return(json);
        } catch (error) {
          console.error(error.message);
        }
      }

      function obj_to_card(obj) {
        var html = '<div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6 space-y-4 hover:shadow-md transition-shadow">'

        let text_icon;
        switch(obj.nature) {
          case "Normative":
            text_icon = "üéØ"
            break;
          case "Descriptive":
            text_icon = "üìä"
            break;
          case "Exploratory":
            text_icon = "üîç"
            break;
          default:
            text_icon = ""
        }

        html += '<div class="flex justify-between items-start"><div class="flex items-start gap-3">';
        html += '<div class="text-2xl">' + text_icon + '</div>';

        html += '<div>';
        html += '<h3 class="text-lg font-semibold text-emerald-900">' + obj.name + '</h3>';
        html += '<div class="flex gap-2 mt-1">';
        html += '<span class="inline-flex items-center rounded-full bg-emerald-50 px-2 py-1 text-xs font-medium text-emerald-700">' + obj.nature + '</span>';
        html += '<span class="inline-flex items-center rounded-full bg-amber-50 px-2 py-1 text-xs font-medium text-amber-700 gap-1"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-thermometer h-3 w-3"><path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"></path></svg>';
        html += obj.target_temperature;
        html += '</span>';
        html += '</div>';
        html += '</div>';
        html += '</div>';
        html += '</div>';

        html += '<p class="text-sm text-gray-600 line-clamp-2">' + obj.description + '</p>';

        html += '<div class="space-y-3">';
        html += '<div class="flex items-center text-sm">';
        html += '<span class="font-medium text-gray-500">Publisher:</span>';
        html += '<span class="ml-2 text-emerald-800">' + obj.source + '</span>';
        html += '</div>';
        html += '<div class="flex items-center gap-2 text-sm">';
        html += '<i data-lucide="calendar" class="lucide lucide-earth h-4 w-4 text-emerald-600"></i>';
        html += '<span class="text-gray-600">Published: ' + obj.created_on + '</span>';
        html += '</div>';
        html += '<div class="flex items-center gap-2 text-sm">';
        html += '<i data-lucide="target" class="lucide lucide-earth h-4 w-4 text-emerald-600"></i>';
        html += '<span class="text-gray-600">Target: ' + obj.time_horizon + '</span>';
        html += '</div>';
        html += '<div class="flex items-center gap-2 text-sm">';
        html += '<i data-lucide="chart-no-axes-combined" class="lucide lucide-earth h-4 w-4 text-emerald-600"></i>';
        html += '<div class="flex flex-wrap gap-1">';
        html += 'Usage: <span class="inline-flex items-center rounded-full bg-gray-50 px-2 py-0.5 text-xs font-medium text-gray-600">' + obj.usage + '</span>';
        html += '</div>';
        html += '</div>';
        html += '</div>';

        html += '</div>';

        return html;
      }

      function array_to_cards(array) {
        html = "";
        array.forEach((obj) => html += obj_to_card(obj));
        return html;
      }

      function loadData() {
        callApi(document.getElementById("route").value, api_key = document.getElementById("api_key").value)
        .then((data) => {
          const my_tables = document.querySelector("div#cards-grid");
          if (Array.isArray(data)) {
            my_tables.innerHTML = array_to_cards(data);
          } else {
            my_tables.innerHTML = null;
          }
          lucide.createIcons();
        });

        callApi(document.getElementById("route").value, api_key = document.getElementById("api_key").value)
        .then((data) => {
          document.getElementById("json").innerHTML = JSON.stringify(data, undefined, 2);
        });
      }
    </script>
  </head>

  <body>
    <details>
      <summary>developer</summary>
      <form>
      <div class="input-group mb-3">
        <span class="input-group-text" id="basic-addon1">API key:</span>
        <input type="text" id="api_key" value="abc123" class="form-control" onkeydown="if(event.key === 'Enter') { loadData(); }">
      </div>
      <div class="input-group mb-3">
        <span class="input-group-text" id="basic-addon1">route:</span>
        <input type="text" id="route" value="/scenarios" class="form-control" onkeydown="if(event.key === 'Enter') { loadData(); }">
      </div>
    </form>
    JSON reponse:
    <pre><code id="json"></code></pre>
    </details>

    <hr>

    <div id="cards-grid" class="grid gap-6 lg:grid-cols-2 xl:grid-cols-3"></div>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script>loadData();</script>
  </body>

</html>
