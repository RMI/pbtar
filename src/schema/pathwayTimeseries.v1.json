{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "http://pathways-library.rmi.org/schema/pathwayTimeseries.v1.json",
  "title": "PBTAR Scenarios Timeseries Schema",
  "description": "A schema for the scenarios metadata dataset in PBTAR.",
  "type": "object",
  "$defs": {
    "sectorDisplayName": {
      "type": "string",
      "enum": [
        "Land Use",
        "Agriculture",
        "Buildings",
        "Industry",
        "Steel",
        "Cement",
        "Chemicals",
        "Coal Mining",
        "Oil (Upstream)",
        "Gas (Upstream)",
        "Power",
        "Automotive",
        "Transport",
        "Road transport",
        "Aviation",
        "Rail",
        "Shipping",
        "Other"
      ]
    }
  },
  "properties": {
    "$schema": {
      "description": "URI of the schema that validates this document (see https://json-schema.org/).",
      "type": "string",
      "maxLength": 1000
    },
    "id": {
      "description": "The unique identifier for a scenario.",
      "type": "string",
      "maxLength": 100
    },
    "name": {
      "description": "Name of the scenario.",
      "type": "string",
      "maxLength": 100
    },
    "description": {
      "description": "Brief description of the scenario.",
      "type": "string",
      "pattern": "\\.$",
      "maxLength": 100
    },
    "publisher": {
      "description": "Publisher of the scenario.",
      "type": "string",
      "maxLength": 100
    },
    "publicationName": {
      "description": "Publisher of the scenario.",
      "type": "string",
      "maxLength": 100
    },
    "publicationYear": {
      "description": "Year that the scenario was published.",
      "type": "integer",
      "minimum": 1900,
      "maximum": 2030
    },
    "pathwayName": {
      "description": "Name of the assosciated scenario.",
      "type": "string",
      "maxLength": 100
    },
    "source": {
      "description": "Data source for the scenario data.",
      "type": "string",
      "maxLength": 500
    },
    "emissionsScope": {
      "description": "Defines which greenhouse gases are covered in the scenarioâ€™s emissions accounting.",
      "type": "string",
      "enum": [
        "No information",
        "CO2",
        "CO2e (Kyoto)",
        "CO2e (CO2, Methane)",
        "Other"
      ]
    },
    "sector": {
      "description": "Sectors that the scenario data covers.",
      "type": "object",
      "patternProperties": {
        "^[A-Za-z0-9 _-]{1,100}$": {
          "type": "object",
          "properties": {
            "displayName": {
              "description": "Display name of the sector as presented in charts or tables.",
              "$ref": "#/$defs/sectorDisplayName"
            },
            "technology": {
              "description": "Technologies that belong to this sector, each with a name and definition.",
              "type": "object",
              "patternProperties": {
                "^[A-Za-z0-9 _-]{1,100}$": {
                  "type": "object",
                  "properties": {
                    "displayName": {
                      "description": "Display name of the technology as presented in charts or tables.",
                      "type": "string",
                      "maxLength": 100
                    },
                    "definition": {
                      "description": "Brief definition or description of the technology scope (e.g., what it includes or excludes).",
                      "type": "string",
                      "maxLength": 1000
                    }
                  },
                  "additionalProperties": false,
                  "required": ["displayName", "definition"]
                }
              },
              "additionalProperties": false,
              "minProperties": 1
            },
            "metric": {
              "description": "Metrics available for this sector, describing what quantities are tracked (e.g., capacity, emissions).",
              "type": "object",
              "patternProperties": {
                "^[A-Za-z0-9 _-]{1,100}$": {
                  "type": "object",
                  "properties": {
                    "displayName": {
                      "description": "Display name of the metric as presented in charts or tables.",
                      "type": "string",
                      "maxLength": 100
                    },
                    "definition": {
                      "description": "Brief definition or description of the metric.",
                      "type": "string",
                      "maxLength": 1000
                    },
                    "sectorScope": {
                      "description": "Specifies whether the metric applies to the whole sector or a sub-sector context.",
                      "type": "string",
                      "maxLength": 1000
                    }
                  },
                  "additionalProperties": false,
                  "required": ["displayName", "definition", "sectorScope"]
                }
              },
              "additionalProperties": false,
              "minProperties": 1
            }
          }
        }
      },
      "additionalProperties": false,
      "minProperties": 1
    },
    "data": {
      "description": "Array of yearly data points for each sector, technology, and metric defined in this timeseries.",
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "year": {
            "description": "Calendar year of the data point.",
            "type": "integer",
            "minimum": 1900,
            "maximum": 2100
          },
          "geography": {
            "description": "Geographical areas that the scenario covers. Can include 'Global', country ISO-3166-1 alpha-2 codes (US, DE), or free-text region names (e.g., 'Europe', 'OECD'). Any 2-letter items in the array will be treated as an ISO code. Any 2-letter entries that do not map to a country will throw errors (EU). Do not use full country names, only ISO alpha-2 codes. To avoid typographical errors, items in this array may not be 3 letters long (USA)",
            "type": "string",
            "allOf": [
              { "pattern": "^(?!\\s*$).+" },
              { "not": { "pattern": "^[A-Za-z]{3}$" } }
            ]
          },
          "sector": {
            "description": "Sector to which this data point belongs (must match one of the defined sectors).",
            "$ref": "#/$defs/sectorDisplayName"
          },
          "technology": {
            "description": "Technology represented in this record (e.g., Solar, Wind, or null if sector-level only).",
            "type": ["string", "null"]
          },
          "metric": {
            "description": "Metric reported for this record (e.g., Capacity, Generation, Emissions Intensity).",
            "type": "string"
          },
          "value": {
            "description": "Numeric value of the metric for the given year, sector, and technology.",
            "type": ["number", "null"]
          },
          "unit": {
            "description": "Measurement unit associated with the metric value (e.g., GW, TWh, tCO2e).",
            "type": "string"
          }
        },
        "additionalProperties": false,
        "required": [
          "year",
          "value",
          "geography",
          "sector",
          "technology",
          "metric",
          "unit"
        ],
        "if": {
          "properties": { "sector": { "const": "Power" } },
          "required": ["sector"]
        },
        "then": {
          "properties": {
            "technology": {
              "type": ["string", "null"],
              "enum": [
                "Coal",
                "Oil",
                "Gas",
                "Nuclear",
                "Hydro",
                "Wind",
                "Solar",
                "Biomass",
                "Geothermal",
                "Hydrogen",
                "Renewables",
                "Battery",
                "Other",
                null
              ]
            },
            "metric": {
              "type": "string",
              "enum": [
                "Emissions Intensity",
                "Absolute Emissions",
                "Capacity",
                "Generation",
                "Technology Mix"
              ]
            }
          },
          "allOf": [
            {
              "if": {
                "properties": {
                  "metric": { "const": "Emissions Intensity" }
                },
                "required": ["metric"]
              },
              "then": { "properties": { "unit": { "const": "tCO2e/MWh" } } }
            },
            {
              "if": {
                "properties": {
                  "metric": { "const": "Absolute Emissions" }
                },
                "required": ["metric"]
              },
              "then": { "properties": { "unit": { "const": "tCO2e" } } }
            },
            {
              "if": {
                "properties": { "metric": { "const": "Capacity" } },
                "required": ["metric"]
              },
              "then": { "properties": { "unit": { "const": "GW" } } }
            },
            {
              "if": {
                "properties": { "metric": { "const": "Generation" } },
                "required": ["metric"]
              },
              "then": { "properties": { "unit": { "const": "TWh" } } }
            },
            {
              "if": {
                "properties": { "metric": { "const": "Technology Mix" } },
                "required": ["metric"]
              },
              "then": { "properties": { "unit": { "const": "%" } } }
            }
          ]
        }
      }
    }
  },
  "additionalProperties": false,
  "required": [
    "id",
    "name",
    "description",
    "publisher",
    "publicationName",
    "publicationYear",
    "pathwayName",
    "source",
    "emissionsScope",
    "sector",
    "data"
  ]
}
