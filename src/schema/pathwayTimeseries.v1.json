{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "http://pathways.rmi.org/schema/pathwayTimeseries.v1.json",
  "title": "Pathway Timeseries",
  "description": "A schema for the pathway timeseries dataset in PBTAR.",
  "type": "object",
  "properties": {
    "$schema": {
      "description": "URI of the schema that validates this document (see https://json-schema.org/).",
      "type": "string",
      "maxLength": 1000
    },
    "id": {
      "description": "The unique identifier for a pathway.",
      "type": "string",
      "maxLength": 100
    },
    "pathwayId": {
      "description": "Identifiers of the associated pathways.",
      "type": "array",
      "items": {
        "type": "string",
        "maxLength": 100,
        "minLength": 1
      }
    },
    "name": {
      "description": "Name of the timeseries.",
      "type": "string",
      "maxLength": 100
    },
    "description": {
      "description": "Brief description of the timeseries.",
      "type": "string",
      "pattern": "\\.$",
      "maxLength": 100
    },
    "publication": {
      "description": "Bibliographic information about the report or dataset.",
      "$ref": "http://pathways.rmi.org/schema/common/publication.v1.json",
      "tsType": "import('./common/publication.v1').PublicationV1"
    },
    "pathwayName": {
      "description": "Name of the associated pathway.",
      "type": "string",
      "maxLength": 100
    },
    "emissionsScope": {
      "$ref": "http://pathways.rmi.org/schema/common/emissionsScope.v1.json",
      "tsType": "import('./common/emissionsScope.v1').EmissionsScopeV1"
    },
    "sector": {
      "description": "Sectors that the timeseries data covers.",
      "type": "object",
      "patternProperties": {
        "^[A-Za-z0-9 _-]{1,100}$": {
          "type": "object",
          "properties": {
            "displayName": {
              "description": "Display name of the sector as presented in charts or tables.",

              "$ref": "http://pathways.rmi.org/schema/common/sector.v1.json#/$defs/displayName"
            },
            "technology": {
              "description": "Technologies that belong to this sector, each with a name and definition.",
              "type": "object",
              "patternProperties": {
                "^[A-Za-z0-9 _-]{1,100}$": {
                  "$ref": "http://pathways.rmi.org/schema/common/technology.v1.json"
                }
              },
              "additionalProperties": false,
              "minProperties": 1
            },
            "metric": {
              "description": "Metrics available for this sector, describing what quantities are tracked (e.g., capacity, emissions).",
              "type": "object",
              "patternProperties": {
                "^[A-Za-z0-9 _-]{1,100}$": {
                  "$ref": "http://pathways.rmi.org/schema/common/metric.v1.json"
                }
              },
              "additionalProperties": false,
              "minProperties": 1
            }
          }
        }
      },
      "additionalProperties": false,
      "minProperties": 1
    },
    "data": {
      "description": "Array of yearly data points for each sector, technology, and metric defined in this timeseries.",
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "year": {
            "description": "Calendar year of the data point.",
            "type": "integer",
            "minimum": 1900,
            "maximum": 2100
          },
          "geography": {
            "description": "Geographical area that the data covers. This should be a single string value: either 'Global', a country ISO-3166-1 alpha-2 code (e.g., 'US', 'DE'), or a free-text region name (e.g., 'North America', 'South East Asia'). Only 2-letter codes are accepted for countries; do not use full country names or 3-letter codes (e.g., 'USA' is not allowed). If a 2-letter code does not map to a country (e.g., 'EU'), it will result in an error.",
            "$ref": "http://pathways.rmi.org/schema/common/geographyItem.v1.json",
            "tsType": "import('./common/geographyItem.v1').GeographyItemV1"
          },
          "sector": {
            "description": "Sector to which this data point belongs (must match one of the defined sectors).",
            "type": "string",
            "enum": [
              "landUse",
              "agriculture",
              "buildings",
              "industry",
              "steel",
              "cement",
              "chemicals",
              "coalMining",
              "oilUpstream",
              "gasUpstream",
              "power",
              "automotive",
              "transport",
              "roadtransport",
              "aviation",
              "rail",
              "shipping",
              "other"
            ]
          },
          "technology": {
            "description": "Technology represented in this record (e.g., Solar, Wind, or null if sector-level only).",
            "type": ["string", "null"],
            "enum": [
              "precisionAgriculture",
              "agroforestry",
              "bioenergyCrops",
              "energyEfficiency",
              "smartGrids",
              "renewableHeating",
              "heatPumps",
              "buildingAutomation",
              "smartAppliances",
              "insulation",
              "carbonCaptureandStorage",
              "electrification",
              "processOptimization",
              "hydrogenUse",
              "coal",
              "oil",
              "gas",
              "wind",
              "solar",
              "nuclear",
              "biomass",
              "hydro",
              "renewables",
              "electricVehicles",
              "hydrogenVehicles",
              "biofuels",
              "publicTransport",
              "activeMobility",
              "aviationEfficiency",
              "maritimeEfficiency",
              "other",
              null
            ]
          },
          "metric": {
            "description": "Metric reported for this record (e.g., Capacity, Generation, Emissions Intensity).",
            "type": "string",
            "enum": [
              "emissionsIntensity",
              "capacity",
              "generation",
              "technologyMix",
              "absoluteEmissions"
            ]
          },
          "value": {
            "description": "Numeric value of the metric for the given year, sector, and technology.",
            "type": "number"
          },
          "unit": {
            "description": "Measurement unit associated with the metric value (e.g., GW, TWh, tCO2e).",
            "type": "string",
            "enum": ["tCO2e/MWh", "MtCO2e", "GW", "TWh", "%"]
          }
        },
        "additionalProperties": false,
        "required": [
          "year",
          "value",
          "geography",
          "sector",
          "technology",
          "metric",
          "unit"
        ],
        "allOf": [
          {
            "$comment": "Emissions intensity values should fall within a reasonable physical bound (âˆ’2 to 2 tCO2e/MWh). Ensures data sanity and prevents unit/scale mistakes.",
            "if": {
              "properties": {
                "metric": { "const": "emissionsIntensity" }
              },
              "required": ["metric"]
            },
            "then": {
              "properties": {
                "value": {
                  "type": "number",
                  "minimum": -2,
                  "maximum": 2
                }
              }
            }
          },
          {
            "$comment": "Capacity (GW) cannot be negative. Enforces basic physical constraint.",
            "if": {
              "properties": {
                "metric": { "const": "capacity" }
              },
              "required": ["metric"]
            },
            "then": {
              "properties": {
                "value": {
                  "type": "number",
                  "minimum": 0
                }
              }
            }
          },
          {
            "$comment": "Electricity generation (TWh) must be non-negative. Ensures no sign errors or inverted units.",
            "if": {
              "properties": {
                "metric": { "const": "generation" }
              },
              "required": ["metric"]
            },
            "then": {
              "properties": {
                "value": {
                  "type": "number",
                  "minimum": 0
                }
              }
            }
          },
          {
            "$comment": "Technology mix values represent percentages, so each row must lie between 0% and 100%.",
            "if": {
              "properties": {
                "metric": { "const": "technologyMix" },
                "unit": { "const": "%" }
              },
              "required": ["metric", "unit"]
            },
            "then": {
              "properties": {
                "value": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 100
                }
              }
            }
          },
          {
            "$comment": "Historical global power sector emissions (<= 2023) should not exceed ~20,000 MtCO2e. Caps unrealistic values and unit mistakes.",
            "if": {
              "properties": {
                "metric": { "const": "absoluteEmissions" },
                "unit": { "const": "MtCO2e" },
                "geography": { "const": "Global" },
                "sector": { "const": "power" },
                "year": { "type": "integer", "maximum": 2023 }
              },
              "required": ["metric", "unit", "geography", "sector", "year"]
            },
            "then": {
              "properties": {
                "value": {
                  "type": "number",
                  "maximum": 20000
                }
              }
            }
          },
          {
            "$comment": "Future global power sector emissions (>= 2024) should not exceed ~30,000 MtCO2e. Allows for scenario variability while trapping implausible values.",
            "if": {
              "properties": {
                "metric": { "const": "absoluteEmissions" },
                "unit": { "const": "MtCO2e" },
                "geography": { "const": "Global" },
                "sector": { "const": "power" },
                "year": { "type": "integer", "minimum": 2024 }
              },
              "required": ["metric", "unit", "geography", "sector", "year"]
            },
            "then": {
              "properties": {
                "value": {
                  "type": "number",
                  "maximum": 30000
                }
              }
            }
          }
        ],
        "if": {
          "properties": { "sector": { "const": "power" } },
          "required": ["sector"]
        },
        "then": {
          "properties": {
            "technology": {
              "type": ["string", "null"],
              "enum": [
                "coal",
                "oil",
                "gas",
                "nuclear",
                "hydro",
                "wind",
                "solar",
                "biomass",
                "geothermal",
                "hydrogen",
                "renewables",
                "battery",
                "other",
                null
              ]
            },
            "metric": {
              "type": "string",
              "enum": [
                "emissionsIntensity",
                "absoluteEmissions",
                "capacity",
                "generation",
                "technologyMix"
              ]
            }
          },
          "allOf": [
            {
              "if": {
                "properties": {
                  "metric": { "const": "emissionsIntensity" }
                },
                "required": ["metric"]
              },
              "then": { "properties": { "unit": { "const": "tCO2e/MWh" } } }
            },
            {
              "if": {
                "properties": {
                  "metric": { "const": "absoluteEmissions" }
                },
                "required": ["metric"]
              },
              "then": { "properties": { "unit": { "const": "MtCO2e" } } }
            },
            {
              "if": {
                "properties": { "metric": { "const": "capacity" } },
                "required": ["metric"]
              },
              "then": { "properties": { "unit": { "const": "GW" } } }
            },
            {
              "if": {
                "properties": { "metric": { "const": "generation" } },
                "required": ["metric"]
              },
              "then": { "properties": { "unit": { "const": "TWh" } } }
            },
            {
              "if": {
                "properties": { "metric": { "const": "technologyMix" } },
                "required": ["metric"]
              },
              "then": { "properties": { "unit": { "const": "%" } } }
            }
          ]
        }
      }
    }
  },
  "additionalProperties": false,
  "required": [
    "id",
    "pathwayId",
    "name",
    "description",
    "publication",
    "pathwayName",
    "emissionsScope",
    "sector",
    "data"
  ]
}
